<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>乒乓对战经典版</title>
  <style>
    :root {
      --bg: #08171f;
      --panel: #102734;
      --line: #285065;
      --text: #e7f7ff;
      --muted: #9ec0d0;
      --accent: #2dd4bf;
      --danger: #fb7185;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 16px;
      background: radial-gradient(circle at 18% 8%, #174257, var(--bg) 50%);
      color: var(--text);
      font-family: "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
    }

    .wrap {
      width: min(860px, 100%);
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: 0 18px 36px rgba(0, 0, 0, 0.35);
      padding: 14px;
    }

    .top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }

    .stats {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .chip {
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 5px 10px;
      color: var(--muted);
      font-size: 14px;
    }

    .chip strong {
      margin-left: 4px;
      color: var(--text);
    }

    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    button {
      border: 1px solid #47718e;
      background: #17384c;
      color: #e9f6ff;
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
      font: inherit;
      font-weight: 600;
    }

    button:hover { border-color: #76a8ce; }
    .primary { background: #1f8f80; border-color: #28aa98; }
    .danger { background: #b94d61; border-color: #d46076; }

    .stage {
      border: 1px solid var(--line);
      border-radius: 12px;
      background: #07171f;
      padding: 8px;
    }

    canvas {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
      border: 1px solid #224657;
      background: #061117;
      touch-action: none;
    }

    .status {
      min-height: 24px;
      margin-top: 8px;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
    }

    .status.end {
      color: var(--danger);
      font-weight: 700;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="stats">
        <div class="chip">你<strong id="playerScore">0</strong></div>
        <div class="chip">AI<strong id="aiScore">0</strong></div>
        <div class="chip">胜利分<strong id="targetScore">7</strong></div>
      </div>
      <div class="actions">
        <button class="primary" id="startBtn">开始</button>
        <button id="pauseBtn">暂停</button>
        <button class="danger" id="restartBtn">重开</button>
      </div>
    </div>

    <div class="stage">
      <canvas id="canvas" width="820" height="460"></canvas>
      <div class="status" id="status">按“开始”进入比赛，↑↓ 或 W/S 控制右侧挡板。</div>
    </div>
  </div>

  <script>
    (() => {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const playerScoreEl = document.getElementById("playerScore");
      const aiScoreEl = document.getElementById("aiScore");
      const targetScoreEl = document.getElementById("targetScore");
      const statusEl = document.getElementById("status");
      const startBtn = document.getElementById("startBtn");
      const pauseBtn = document.getElementById("pauseBtn");
      const restartBtn = document.getElementById("restartBtn");

      const w = canvas.width;
      const h = canvas.height;
      const targetScore = 7;
      targetScoreEl.textContent = String(targetScore);

      const paddleHeight = 94;
      const paddleWidth = 12;

      let running = false;
      let paused = false;
      let over = false;

      const keys = { up: false, down: false };

      let playerScore = 0;
      let aiScore = 0;

      const player = { x: w - 28, y: h / 2 - paddleHeight / 2, speed: 6.5 };
      const ai = { x: 16, y: h / 2 - paddleHeight / 2, speed: 4.4 };
      const ball = { x: w / 2, y: h / 2, r: 9, vx: 4.2, vy: 2.4 };

      function setStatus(text, end = false) {
        statusEl.textContent = text;
        statusEl.className = end ? "status end" : "status";
      }

      function resetBall(direction = 1) {
        ball.x = w / 2;
        ball.y = h / 2;
        const speed = 4.2 + (playerScore + aiScore) * 0.08;
        ball.vx = speed * direction;
        ball.vy = (Math.random() * 2 - 1) * 3.1;
      }

      function clampPaddles() {
        player.y = Math.max(0, Math.min(h - paddleHeight, player.y));
        ai.y = Math.max(0, Math.min(h - paddleHeight, ai.y));
      }

      function checkWin() {
        if (playerScore >= targetScore || aiScore >= targetScore) {
          over = true;
          running = false;
          const win = playerScore > aiScore;
          setStatus(win ? "你赢了这场比赛。" : "AI 获胜，点击重开再战。", true);
        }
      }

      function step() {
        if (running && !paused && !over) {
          if (keys.up) player.y -= player.speed;
          if (keys.down) player.y += player.speed;

          const aiCenter = ai.y + paddleHeight / 2;
          if (aiCenter < ball.y - 8) ai.y += ai.speed;
          else if (aiCenter > ball.y + 8) ai.y -= ai.speed;
          clampPaddles();

          ball.x += ball.vx;
          ball.y += ball.vy;

          if (ball.y - ball.r < 0 || ball.y + ball.r > h) {
            ball.vy = -ball.vy;
          }

          if (
            ball.x + ball.r > player.x &&
            ball.y > player.y &&
            ball.y < player.y + paddleHeight &&
            ball.vx > 0
          ) {
            const delta = (ball.y - (player.y + paddleHeight / 2)) / (paddleHeight / 2);
            ball.vx = -Math.abs(ball.vx) * 1.03;
            ball.vy += delta * 1.7;
          }

          if (
            ball.x - ball.r < ai.x + paddleWidth &&
            ball.y > ai.y &&
            ball.y < ai.y + paddleHeight &&
            ball.vx < 0
          ) {
            const delta = (ball.y - (ai.y + paddleHeight / 2)) / (paddleHeight / 2);
            ball.vx = Math.abs(ball.vx) * 1.03;
            ball.vy += delta * 1.4;
          }

          if (ball.x < 0) {
            playerScore += 1;
            playerScoreEl.textContent = String(playerScore);
            resetBall(-1);
            checkWin();
          } else if (ball.x > w) {
            aiScore += 1;
            aiScoreEl.textContent = String(aiScore);
            resetBall(1);
            checkWin();
          }
        }

        draw();
        requestAnimationFrame(step);
      }

      function drawCenterLine() {
        ctx.fillStyle = "rgba(255,255,255,0.17)";
        for (let y = 8; y < h - 8; y += 20) {
          ctx.fillRect(w / 2 - 2, y, 4, 12);
        }
      }

      function draw() {
        ctx.clearRect(0, 0, w, h);

        drawCenterLine();

        ctx.fillStyle = "#7dd3fc";
        ctx.fillRect(ai.x, ai.y, paddleWidth, paddleHeight);

        ctx.fillStyle = "#2dd4bf";
        ctx.fillRect(player.x, player.y, paddleWidth, paddleHeight);

        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
        ctx.fillStyle = "#f8fafc";
        ctx.fill();
      }

      function restart() {
        playerScore = 0;
        aiScore = 0;
        playerScoreEl.textContent = "0";
        aiScoreEl.textContent = "0";
        player.y = h / 2 - paddleHeight / 2;
        ai.y = h / 2 - paddleHeight / 2;
        over = false;
        paused = false;
        running = false;
        resetBall(Math.random() < 0.5 ? -1 : 1);
        setStatus("按“开始”进入比赛，↑↓ 或 W/S 控制右侧挡板。");
      }

      function start() {
        if (over) return;
        running = true;
        paused = false;
        setStatus("比赛进行中。");
      }

      function togglePause() {
        if (!running || over) return;
        paused = !paused;
        setStatus(paused ? "已暂停。" : "比赛进行中。");
      }

      document.addEventListener("keydown", (event) => {
        const key = event.key.toLowerCase();
        if (key === "arrowup" || key === "w") keys.up = true;
        if (key === "arrowdown" || key === "s") keys.down = true;
        if (key === " ") {
          event.preventDefault();
          if (!running) start();
          else togglePause();
        }
      });

      document.addEventListener("keyup", (event) => {
        const key = event.key.toLowerCase();
        if (key === "arrowup" || key === "w") keys.up = false;
        if (key === "arrowdown" || key === "s") keys.down = false;
      });

      canvas.addEventListener("mousemove", (event) => {
        const rect = canvas.getBoundingClientRect();
        const y = ((event.clientY - rect.top) / rect.height) * h;
        player.y = y - paddleHeight / 2;
        clampPaddles();
      });

      canvas.addEventListener("touchmove", (event) => {
        const touch = event.changedTouches[0];
        const rect = canvas.getBoundingClientRect();
        const y = ((touch.clientY - rect.top) / rect.height) * h;
        player.y = y - paddleHeight / 2;
        clampPaddles();
      }, { passive: true });

      startBtn.addEventListener("click", start);
      pauseBtn.addEventListener("click", togglePause);
      restartBtn.addEventListener("click", restart);

      restart();
      requestAnimationFrame(step);
    })();
  </script>
</body>
</html>
